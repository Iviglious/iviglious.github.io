<!doctype html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YX4KMB21KE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-YX4KMB21KE');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Node Optimizer - Spark Executor Visualizer</title>
  <link href="../favicon.ico" rel="icon" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <div class="top-bar">
      <header>
        <h1>Node Optimizer</h1>
        <p>Visualize how Apache Spark executors are distributed across nodes.</p>
      </header>

      <section class="controls">
        <div class="inputs">
          <b>Parameters: </b> 
          <label>Node vCPUs:<input id="nodeVcpus" type="number" min="1" max="999" value="32" inputmode="numeric"></label>
          <label>Node memory (GB):<input id="nodeMemoryGb" type="number" min="1" max="999" step="1" value="244" inputmode="numeric"></label>
          <label>spark.executor.memoryOverheadFactor:
            <input id="executorOverheadFactor" type="number" min="0.0" max="100.0" step="0.0001" value="0.1875" inputmode="decimal">
            <small class="hint" title="Enter 0.1875 for 18.75% overhead">Enter 0.1875 for 18.75% overhead</small>
          </label>
        </div>
        <div class="inputs">
          <label>spark.executor.cores:<input id="executorCores" type="number" min="1" max="999" value="8" inputmode="numeric"></label>
          <label>spark.executor.memory (GB):<input id="executorMemoryGb" type="number" min="1" max="999" step="1" value="49" inputmode="decimal"></label>
           <label>spark.dynamicAllocation.maxExecutors:<input id="maxExecutors" type="number" min="1" max="999" value="7" inputmode="numeric"></label>
        </div>
      </section>
    </div>

    <div class="tabs">
      <div class="tab-buttons">
        <button id="tab-visual-btn" class="active">Visual Distribution</button>
        <button id="tab-optimal-btn">Optimal Combinations</button>
      </div>

      <div id="tab-visual" class="tab-panel">
        <section class="visual">
          <div class="summary" id="summary"></div>
          <canvas id="canvas" aria-label="Node and executors visualization"></canvas>
        </section>
      </div>

      <div id="tab-optimal" class="tab-panel" style="display:none; padding:12px;">
        <h2>Optimal Combinations</h2>
        <label>Target max nodes:<input id="targetMaxNodes" type="number" min="1" max="999" value="2" inputmode="numeric"></label>
        <p>Rows show executor cores from 2 up to node vCPUs. Values recompute as inputs change.</p>
        <p>- Shuffle partitions = number of executors x cores x 4</p>
        <div class="optimal-table-wrap">
          <table id="optimalTable" border="1" cellpadding="6" cellspacing="0">
            <thead>
              <tr>
                <th>Executor cores</th>
                <th>Unused cores</th>
                <th>Max executor memory (GB)</th>
                <th>Max executors</th>
                <th>Shuffle partitions</th>
                <th>Show Configuration</th>
              </tr>
            </thead>
            <tbody id="optimalTableBody">
              <!-- rows injected by app.js -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <a href="../index.html">Back to home</a>
  </footer>

  <script src="app.js"></script>
</body>
</html>
